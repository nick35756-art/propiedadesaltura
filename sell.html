<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Publicar Propiedad ‚Äì Propiedades Altura</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="sell.css">

  <!-- Wompi Widget -->
  <script src="https://checkout.wompi.co/widget.js"></script>

  <style>
    /* Modal styling */
    #wompi-modal {
      display:none;
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.85);
      z-index:9999;
      align-items:center;
      justify-content:center;
    }
    #wompi-modal .modal-box {
      background:white;
      padding:3rem 2.5rem;
      border-radius:24px;
      max-width:480px;
      width:92%;
      position:relative;
      box-shadow:0 30px 60px rgba(0,0,0,0.4);
    }
    #close-wompi {
      position:absolute;
      top:12px;
      right:18px;
      font-size:3rem;
      background:none;
      border:none;
      cursor:pointer;
      line-height:1;
    }
  </style>
</head>

<body>

<!-- ========================================================= -->
<!-- üöÄ WOMPI MODAL (Top of page ‚Äî recommended placement)      -->
<!-- ========================================================= -->
<div id="wompi-modal">
  <div class="modal-box">
    <button type="button" id="close-wompi">√ó</button>

    <h3 style="text-align:center;margin:0 0 2rem;font-size:1.9rem;">
      Pagar 30000 COP<br>
      <small style="font-weight:400;">Publicaci√≥n destacada ¬∑ 30 d√≠as</small>
    </h3>

    <!-- Luxury Green Button -->
    <button 
      class="wompi-pay-button"
      data-wompi-public-key="pub_prod_yox45S7KpBV92AtlTeTXMHgYMB2m6XRp"
      data-amount="30000"
      data-currency="COP"
      data-reference-prefix="LISTING-"
      data-description="Publicaci√≥n destacada 30 d√≠as - Propiedades Altura"
      data-redirect-url="https://propiedadesaltura.com/gracias-pago.html"
      style="background:#10b981;color:white;padding:1.8rem;font-size:1.7rem;border:none;border-radius:16px;width:100%;font-weight:700;">
      Pagar 30000 COP
    </button>
  </div>
</div>

<!-- ========================================================= -->
<!-- PAGE HEADER / CONTENT                                     -->
<!-- ========================================================= -->

<header class="site-header" role="banner">
  <div class="wrap header-inner">
    <a class="logo" href="/">
      <svg class="logo-icon" viewBox="0 0 64 64"><path d="M4 56 L32 8 L60 56 Z" fill="currentColor"/></svg>
      <span class="brand">Propiedades Altura</span>
    </a>
  </div>
</header>

<main class="page">
  <section style="text-align:center;margin:3rem auto;">
    <h1>Publicar Propiedad</h1>
    <p style="max-width:700px;margin:1rem auto;font-size:1.3rem;">
      Publicaci√≥n destacada por 30 d√≠as. Selecciona pagar o continuar sin pago.
    </p>

    <!-- BUTTON THAT OPENS WOMPI MODAL -->
    <button id="paid-listing-trigger" class="gold-btn" 
      style="background:black;color:#FFD700;padding:1.6rem 2.2rem;font-size:1.6rem;border-radius:18px;border:none;cursor:pointer;">
      Publicaci√≥n Destacada (Opcional)
    </button>
  </section>

  <!-- FORM CONTAINER (hidden until modal closes or payment succeeds) -->
  <div id="form-container" style="display:none;margin-top:3rem;">

    <h2>Informaci√≥n de la Propiedad</h2>

    <form class="form-grid" name="sell" method="POST" data-netlify="true" enctype="multipart/form-data">

      <input type="hidden" name="form-name" value="sell">

      <div><label>Nombre *</label><input type="text" name="name" required></div>
      <div><label>Email *</label><input type="email" name="email" required></div>
      <div><label>Tel√©fono *</label><input type="tel" name="phone" required></div>
      <div><label>Ciudad / Municipio</label><input type="text" name="city"></div>

      <div class="full-width">
        <label>Ubicaci√≥n (clic en el mapa)</label>
        <div id="map" style="height:420px;border-radius:14px;"></div>
        <input type="hidden" id="lat" name="latitude">
        <input type="hidden" id="lng" name="longitude">
        <input type="hidden" id="maps-link" name="google_maps_link">
        <small id="coords" style="color:#1d4ed8;"></small>
        <a id="open-map" href="#" target="_blank" style="color:#1d4ed8;display:none;">Abrir en Google Maps</a>
      </div>

      <div><label>Tipo de Propiedad</label>
        <select name="property_type">
          <option>Casa</option>
          <option>Apartamento</option>
          <option>Finca</option>
          <option>Lote</option>
          <option>Local</option>
          <option>Bodega</option>
        </select>
      </div>

      <div><label>√Årea Construida (m¬≤)</label><input type="number" name="area_m2"></div>
      <div><label>√Årea Lote (m¬≤)</label><input type="number" name="lot_size"></div>
      <div><label>Habitaciones</label><input type="number" name="bedrooms"></div>
      <div><label>Ba√±os</label><input type="number" name="bathrooms"></div>
      <div><label>Parqueaderos</label><input type="number" name="parking"></div>
      <div><label>Precio Esperado</label><input type="number" name="price"></div>

      <div class="full-width" style="margin:1.5rem 0;">
        <label>
          <input type="checkbox" name="owner_financing">
          Estoy abierto a financiaci√≥n directa con el comprador.
        </label>
      </div>

      <div class="full-width">
        <label>Fotos (m√°x 10)</label>
        <div class="photo-upload">
          <input type="file" id="photos" name="photos" accept="image/*" multiple style="display:none;">
          <p><strong>Clic o arrastra aqu√≠</strong><br><small>M√°ximo 10 fotos</small></p>
        </div>
        <div id="preview"></div>
      </div>

      <div class="full-width">
        <label>Mensaje adicional</label>
        <textarea name="message"></textarea>
      </div>

      <div class="full-width">
        <button type="submit" class="gold-btn" style="padding:1.6rem;font-size:1.7rem;background:black;color:#FFD700;border:none;border-radius:16px;">
          Enviar Informaci√≥n
        </button>
      </div>

    </form>
  </div>
</main>

<!-- ========================================================= -->
<!-- SCRIPTS                                                   -->
<!-- ========================================================= -->

<script>
/* -------------------------------
   OPEN WOMPI MODAL
--------------------------------*/
document.getElementById("paid-listing-trigger").addEventListener("click", () => {
  document.getElementById("wompi-modal").style.display = "flex";
});

/* ----------------------------------
   CLOSE MODAL ‚Üí ALWAYS SHOW FORM
-----------------------------------*/
function showFormAndCloseModal() {
  document.getElementById("wompi-modal").style.display = "none";
  document.getElementById("form-container").style.display = "block";
  document.getElementById("form-container").scrollIntoView({ behavior: "smooth" });
}

document.getElementById("close-wompi").addEventListener("click", showFormAndCloseModal);

document.getElementById("wompi-modal").addEventListener("click", e => {
  if (e.target === document.getElementById("wompi-modal")) {
    showFormAndCloseModal();
  }
});

document.addEventListener("keydown", e => {
  if (e.key === "Escape") showFormAndCloseModal();
});

/* -------------------------------
   AFTER WOMPI PAYMENT SUCCESS
--------------------------------*/
window.addEventListener("wompi-success", showFormAndCloseModal);

/* -------------------------------
   PHOTO UPLOAD PREVIEW
--------------------------------*/
const input = document.getElementById("photos");
const preview = document.getElementById("preview");
const uploadBox = document.querySelector(".photo-upload");

uploadBox.addEventListener("click", () => input.click());

["dragover","dragenter"].forEach(evt => uploadBox.addEventListener(evt, e => {
  e.preventDefault(); uploadBox.style.borderColor="#1d4ed8";
}));

["dragleave","drop"].forEach(evt => uploadBox.addEventListener(evt, e => {
  e.preventDefault(); uploadBox.style.borderColor="#ccc";
}));

uploadBox.addEventListener("drop", e => {
  input.files = e.dataTransfer.files;
  handleFiles(input.files);
});

input.addEventListener("change", () => handleFiles(input.files));

function handleFiles(files) {
  preview.innerHTML = "";
  for (let i = 0; i < Math.min(files.length, 10); i++) {
    if (files[i].type.startsWith("image/")) {
      const img = document.createElement("img");
      img.src = URL.createObjectURL(files[i]);
      img.style.height = "130px";
      img.style.margin = "6px";
      img.style.borderRadius = "10px";
      preview.appendChild(img);
    }
  }
  if (files.length > 10) {
    preview.innerHTML += `<small style="color:red;">Solo 10 fotos permitidas.</small>`;
  }
}

/* -------------------------------
   GOOGLE MAP
--------------------------------*/
window.initSellMap = function() {
  const map = new google.maps.Map(document.getElementById("map"), {
    center: { lat: 6.1935, lng: -75.3832 },
    zoom: 10,
  });

  let marker = null;

  map.addListener("click", e => {
    const lat = e.latLng.lat();
    const lng = e.latLng.lng();

    if (marker) marker.setPosition(e.latLng);
    else marker = new google.maps.Marker({ position: e.latLng, map });

    document.getElementById("lat").value = lat.toFixed(6);
    document.getElementById("lng").value = lng.toFixed(6);

    const url = `https://www.google.com/maps?q=${lat},${lng}&z=18`;
    document.getElementById("maps-link").value = url;
    document.getElementById("coords").textContent = `Guardado: ${lat.toFixed(5)}, ${lng.toFixed(5)}`;
    document.getElementById("open-map").href = url;
    document.getElementById("open-map").style.display = "inline";
  });
};
</script>

<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCoIGK7pUUxiu0nJSJ79ckIcayGm5O31Zo&callback=initSellMap"></script>

</body>
</html>
