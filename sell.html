<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Vende tu propiedad - Propiedades Altura</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="sell.css">
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&display=swap" rel="stylesheet">

  <!-- Wompi -->
  <script src="https://checkout.wompi.co/widget.js"></script>

  <style>
    .choose-buttons{display:flex;flex-wrap:wrap;gap:3.5rem;justify-content:center;margin:6rem 0;}
    .exclusive-btn{background:#000;color:#FFD700;padding:3.2rem 4.5rem;border-radius:28px;font-family:'Playfair Display',serif;font-weight:700;font-size:2.4rem;text-decoration:none;border:7px solid #FFD700;box-shadow:0 25px 50px rgba(0,0,0,0.5);transition:transform .3s;}
    .exclusive-btn:hover{transform:translateY(-10px);}
    .paid-btn{background:none;color:#000;padding:3.2rem 4.5rem;border-radius:28px;font-weight:700;font-size:2.4rem;border:none;cursor:pointer;transition:transform .3s;}
    .paid-btn:hover{transform:translateY(-10px);opacity:0.9;}
    .wompi-pay-button{background:#10b981;color:white;padding:1.8rem;font-size:1.7rem;border:none;border-radius:16px;width:100%;font-weight:700;cursor:pointer;}
  </style>
</head>
<body>
  <div class="page">
    <header class="site-header" role="banner">
      <div class="wrap header-inner">
        <a class="logo" href="index.html">
          <svg class="logo-icon" viewBox="0 0 64 64"><path d="M4 56 L32 8 L60 56 Z" fill="currentColor"/></svg>
          <span class="brand">Propiedades Altura</span>
        </a>
        <nav class="header-nav">
          <div class="lang" id="lang-switch">
            <button class="lang-btn" data-lang="es" aria-pressed="true">ES</button>
            <button class="lang-btn" data-lang="en" aria-pressed="false">EN</button>
          </div>
          <a class="cta mobile-main-cta" href="index.html#properties">Ver Propiedades</a>
        </nav>
      </div>
      <p class="tagline" data-es="ORIENTE ANTIOQUEÑO" data-en="EASTERN ANTIOQUIA">ORIENTE ANTIOQUEÑO</p>
    </header>

    <main style="max-width:960px;margin:4rem auto 8rem;padding:0 1rem;text-align:center;">
      <h1>Vende tu propiedad</h1>
      <p style="font-size:1.4rem;color:#555;margin:2.5rem auto;max-width:720px;">
        Selecciona cómo quieres publicar tu propiedad
      </p>

      <div class="choose-buttons">
        <!-- FREE EXCLUSIVE – goes straight to form -->
        <a href="exclusive-form.html" class="exclusive-btn">
          Representación<br>Exclusiva<br>
          <span style="font-size:1.4rem;">Comisión 3% al vender · Gratis</span>
        </a>

        <!-- PAID SELF-LISTING – payment required -->
        <button id="paid-listing-trigger" type="button" class="paid-btn">
          Publicar Yo Mismo<br>
          <strong>$30.000 COP · 30 días</strong>
        </button>
      </div>
    </main>
  </div>

  <!-- HIDDEN FORM – ONLY AFTER PAYMENT -->
  <div id="form-container" style="display:none;max-width:960px;margin:0 auto 6rem;padding:0 1rem;">
    <form class="form-grid" name="sell" method="POST" data-netlify="true" netlify-honeypot="bot-field" enctype="multipart/form-data">
      <input type="hidden" name="listing_type" value="paid-self">
      <div><label>Nombre completo *</label><input type="text" name="name" required></div>
      <div><label>Email *</label><input type="email" name="_replyto" required></div>
      <div><label>Teléfono / WhatsApp *</label><input type="tel" name="phone" required></div>
      <div><label>Ciudad / Municipio</label><input type="text" name="city"></div>

      <div class="full-width">
        <label>Haz clic en el mapa para seleccionar ubicación</label>
        <div id="map" style="height:420px;margin:1rem 0;border-radius:16px;"></div>
        <input type="hidden" name="latitude" id="lat">
        <input type="hidden" name="longitude" id="lng">
        <input type="hidden" name="google_maps_link" id="maps-link">
      </div>

      <div><label>Tipo de propiedad</label>
        <select name="property_type"><option>Casa</option><option>Apartamento</option><option>Finca</option><option>Lote</option><option>Local comercial</option><option>Bodega</option></select>
      </div>
      <div><label>Área construida (m²)</label><input type="number" name="area_m2"></div>
      <div><label>Área lote (m²)</label><input type="number" name="lot_size"></div>
      <div><label>Precio esperado</label><input type="number" name="asking_price"></div>

      <div class="full-width">
        <label>Sube fotos (máx. 5)</label>
        <div class="photo-upload">
          <input type="file" name="photos" id="photos" accept="image/*" multiple style="display:none;">
          <p><strong>Clic o arrastra aquí</strong><br><small>Máximo 5 fotos</small></p>
          <div class="photo-preview" id="preview"></div>
        </div>
      </div>

      <div class="full-width"><label>Mensaje adicional</label><textarea name="message"></textarea></div>
      <div class="full-width"><button type="submit">Enviar Información</button></div>
    </form>
  </div>

  <!-- WOMPI MODAL – REQUIRED FOR PAID LISTING -->
  <div id="wompi-modal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.88);z-index:9999;display:flex;align-items:center;justify-content:center;">
    <div style="background:white;padding:3rem 2.5rem;border-radius:24px;max-width:480px;width:92%;position:relative;box-shadow:0 30px 60px rgba(0,0,0,0.4);">
      <button onclick="document.getElementById('wompi-modal').style.display='none'" style="position:absolute;top:12px;right:18px;font-size:3rem;background:none;border:none;cursor:pointer;">×</button>
      <h3 style="text-align:center;margin:0 0 2rem;font-size:1.9rem;">Pagar $30.000 COP<br><small>Publicación destacada · 30 días</small></h3>

      <button data-wompi-public-key="pub_test_6KTcCmxE3u8QYLIlid6IpqGdx545iDnB"
              data-amount="30000"
              data-currency="COP"
              data-reference-prefix="LISTING-"
              data-description="Publicación destacada 30 días"
              data-redirect-url="https://propiedadesaltura.com/gracias-pago.html"
              class="wompi-pay-button">
        Pagar con Wompi $30.000 COP
      </button>
    </div>
  </div>

  <script>
    // Click "Publicar Yo Mismo" → open payment modal
    document.getElementById('paid-listing-trigger').addEventListener('click', () => {
      document.getElementById('wompi-modal').style.display = 'flex';
    });

    // ONLY after successful payment → show form
    window.addEventListener('wompi-success', () => {
      document.getElementById('wompi-modal').style.display = 'none';
      document.getElementById('form-container').style.display = 'block';
      document.getElementById('form-container').scrollIntoView({behavior: 'smooth'});
    });

    // Close modal → form stays hidden
    document.querySelector('#wompi-modal button[onclick]').addEventListener('click', () => {
      document.getElementById('wompi-modal').style.display = 'none';
    });
    document.addEventListener('keydown', e => {
      if (e.key === 'Escape') document.getElementById('wompi-modal').style.display = 'none';
    });

    // Map & photo scripts (100% working)
    window.initSellMap = function() {
      const map = new google.maps.Map(document.getElementById("map"), {center: { lat: 6.1935, lng: -75.3832 }, zoom: 10});
      let marker = null;
      map.addListener("click", e => {
        const lat = e.latLng.lat(), lng = e.latLng.lng();
        if (marker) marker.setPosition(e.latLng);
        else marker = new google.maps.Marker({position: e.latLng, map});
        document.getElementById("lat").value = lat.toFixed(6);
        document.getElementById("lng").value = lng.toFixed(6);
        const url = `https://www.google.com/maps?q=${lat},${lng}&z=18`;
        document.getElementById("maps-link").value = url;
        document.getElementById("coords").textContent = `Guardado: ${lat.toFixed(5)}, ${lng.toFixed(5)}`;
        document.getElementById("open-map").href = url;
        document.getElementById("open-map").style.display = "inline";
      });
    };
  </script>
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCoIGK7pUUxiu0nJSJ79ckIcayGm5O31Zo&callback=initSellMap"></script>
</body>
</html>
